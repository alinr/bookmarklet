javascript:(async function(){const ID="gpt-spy-final-name";const old=document.getElementById(ID);if(old)old.remove();if(window.gptSpyObs){window.gptSpyObs.disconnect();delete window.gptSpyObs}let timer=null;const showLoading=()=>{let container=document.getElementById(ID);if(!container){container=document.createElement("div");container.id=ID;const style=document.createElement("style");style.innerHTML=`#${ID} { position: fixed; top: 20px; right: 20px; width: 450px; max-height: 90vh; background-color: #0f172a; color: #e2e8f0; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); z-index: 2147483647; font-family: system-ui, -apple-system, sans-serif; font-size: 13px; border: 1px solid #1e293b; display: flex; flex-direction: column; overflow: hidden; }#${ID} * { box-sizing: border-box; }#${ID}-loading { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 200px; gap: 15px; color: #94a3b8; }.spy-spinner { width: 30px; height: 30px; border: 3px solid rgba(255,255,255,0.1); border-top-color: #38bdf8; border-radius: 50%; animation: spy-spin 1s linear infinite; }@keyframes spy-spin { to { transform: rotate(360deg); } }#${ID}-header { padding: 16px; border-bottom: 1px solid #1e293b; background: #020617; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }#${ID}-content { padding: 0; overflow-y: auto; background: #0f172a; flex-grow: 1; }.spy-details { border-bottom: 1px solid #1e293b; }.spy-summary { padding: 12px 16px; cursor: pointer; background: #0f172a; font-weight: 600; list-style: none; display: flex; align-items: center; justify-content: space-between; transition: background 0.2s; }.spy-summary:hover { background: #1e293b; }.spy-summary::-webkit-details-marker { display: none; }.spy-badge { background: #1e293b; color: #94a3b8; font-size: 11px; padding: 2px 8px; border-radius: 12px; border: 1px solid #334155; }.spy-body { padding: 12px 16px; background: #020617; border-top: 1px solid #1e293b; }.spy-ul { margin: 0; padding: 0; list-style: none; }.spy-li { margin-bottom: 8px; display: flex; align-items: start; line-height: 1.5; color: #cbd5e1; }.spy-q-icon { color: #f472b6; margin-right: 10px; font-weight: bold; }.spy-res-link { color: #38bdf8; text-decoration: none; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-weight: 500; }.spy-res-link:hover { text-decoration: underline; }.spy-res-source { color: #64748b; font-size: 11px; }.spy-footer { text-align: center; font-size: 11px; color: #475569; padding: 12px; background: #020617; border-top: 1px solid #1e293b; flex-shrink: 0; }.spy-model-badge { background: #0f172a; color: #38bdf8; border: 1px solid #1e293b; padding: 2px 6px; border-radius: 4px; font-size: 10px; }%60;container.appendChild(style);const header=document.createElement("div");header.id=%60${ID}-header%60;header.innerHTML=%60<div><strong style="color: #fff; font-size: 16px;">GPT Spy</strong></div><span id="close-spy-mod" style="cursor:pointer; color:#64748b; font-weight:bold; padding:4px;">âœ•</span>%60;container.appendChild(header);const content=document.createElement("div");content.id=%60${ID}-content%60;content.innerHTML=%60<div id="${ID}-loading"><div class="spy-spinner"></div><div>Wir laden die Daten fÃ¼r dich.</div></div>%60;container.appendChild(content);const footer=document.createElement("div");footer.className="spy-footer";footer.textContent="powered by corpusrank.com";container.appendChild(footer);document.body.appendChild(container);header.querySelector("#close-spy-mod").onclick=()=>{if(window.gptSpyObs)window.gptSpyObs.disconnect();container.remove()}}else{const contentBox=container.querySelector(%60#${ID}-content%60);contentBox.innerHTML=%60<div id="${ID}-loading"><div class="spy-spinner"></div><div>Wir laden die Daten fÃ¼r dich.</div></div>%60}};const run=async()=>{showLoading();const match=window.location.href.match(/https:\/\/chatgpt\.com\/c\/([a-f0-9-]+)/);if(!match||!match[1]){render([], "Unknown");return}const convId=match[1];try{const sReq=await fetch("/api/auth/session");if(!sReq.ok)return;const token=(await sReq.json()).accessToken;if(!token)return;const cReq=await fetch(%60https://chatgpt.com/backend-api/conversation/${convId}%60,{headers:{Authorization:%60Bearer ${token}%60}});if(!cReq.ok)return;const data=await cReq.json();if(!data.mapping)return;const nodes=Object.values(data.mapping).filter(n=>n.message&&n.message.create_time).sort((a,b)=>a.message.create_time-b.message.create_time);let events=[];let safe=new Set();let blocked=new Set();let model="Unknown";let currentEvent=null;nodes.forEach(n=>{const m=n.message;if(m.metadata.model_slug)model=m.metadata.model_slug;if(m.metadata.safe_urls)m.metadata.safe_urls.forEach(u=>safe.add(u));if(m.metadata.blocked_urls)m.metadata.blocked_urls.forEach(u=>blocked.add(u));if(m.metadata.search_model_queries&&m.metadata.search_model_queries.queries){let p="Implicit Search";if(n.parent&&data.mapping[n.parent]){const pm=data.mapping[n.parent].message;if(pm&&pm.content){p=pm.content.text||(pm.content.parts?pm.content.parts.join(" "):"Implicit")}}p=p.replace(/^search\s*\(\s*["']|["']\s*\)$/g,"");currentEvent={prompt:p,queries:m.metadata.search_model_queries.queries,results:[]};events.push(currentEvent)}if(m.metadata.search_result_groups&&currentEvent){m.metadata.search_result_groups.forEach(g=>{if(g.entries)g.entries.forEach(e=>{if(e.url)currentEvent.results.push({title:e.title||"No Title",url:e.url,source:e.attribution||g.domain||"Unknown"})})})}});events.reverse();render(events,[...safe],[...blocked],model)}catch(e){console.error("GPT-Spy Error:",e);render([], "Error")}};const debouncedRun=()=>{clearTimeout(timer);timer=setTimeout(run,2500)};window.gptSpyObs=new MutationObserver(ms=>{let upd=false;for(let m of ms){if(m.target.id===ID||(m.target.closest&&m.target.closest("#"+ID)))continue;upd=true}if(upd)debouncedRun()});window.gptSpyObs.observe(document.body,{childList:true,subtree:true});const render=(events,safe,blocked,modelName)=>{let container=document.getElementById(ID);if(!container){showLoading();container=document.getElementById(ID)}const header=container.querySelector(%60#${ID}-header > div%60);header.innerHTML=%60<strong style="color: #fff; font-size: 16px;">GPT Spy</strong> <span class="spy-model-badge">${modelName}</span> <span style="color:#10b981; font-size:16px; margin-left:5px; line-height:0; position:relative; top:3px;">â€¢</span>%60;const contentBox=container.querySelector(%60#${ID}-content%60);contentBox.innerHTML="";if(events.length===0){contentBox.innerHTML='<div style="padding:20px; color:#64748b; text-align:center; font-style: italic;">Keine Suchanfragen gefunden.</div>'}else{events.forEach((evt,idx)=>{const det=document.createElement("details");det.className="spy-details";if(idx===0)det.open=true;const sum=document.createElement("summary");sum.className="spy-summary";sum.innerHTML=%60<div style="display:flex; align-items:center; width:100%; overflow:hidden;"><span style="margin-right:10px; font-size:16px;">ðŸ‘¤</span><span style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis; color:#e2e8f0;">${evt.prompt}</span></div><span class="spy-badge">${idx+1}</span>%60;const body=document.createElement("div");body.className="spy-body";const ul=document.createElement("ul");ul.className="spy-ul";evt.queries.forEach(q=>{ul.innerHTML+=%60<li class="spy-li"><span class="spy-q-icon">?</span><span>${q}</span></li>%60});body.appendChild(ul);if(evt.results.length>0){const rDet=document.createElement("details");rDet.style.marginTop="12px";rDet.innerHTML=%60<summary style="cursor:pointer; color:#38bdf8; font-size:12px; font-weight:bold; margin-bottom:8px; list-style:none;">ðŸ“„ Ergebnisse anzeigen (${evt.results.length})</summary><div style="padding-left:12px; border-left:2px solid #1e293b; margin-top:8px;">${evt.results.map(r=>%60<div style="margin-bottom:8px;"><a href="${r.url}" target="_blank" class="spy-res-link">${r.title}</a><div class="spy-res-source">${r.source}</div></div>%60).join("")}</div>%60;body.appendChild(rDet)}det.appendChild(sum);det.appendChild(body);contentBox.appendChild(det)})}contentBox.appendChild(document.createElement("hr")).style.borderColor="#1e293b";const mkAcc=(title,list,color,icon)=>{const d=document.createElement("details");d.className="spy-details";d.innerHTML=%60<summary class="spy-summary"><div style="display:flex; align-items:center;"><span style="color:${color}; margin-right:8px;">${icon}</span> ${title}</div><span class="spy-badge">${list.length}</span></summary><div class="spy-body" style="word-break:break-all;">${list.length?list.map(u=>%60<div style="margin-bottom:6px;"><a href="${u}" target="_blank" style="color:${color}; opacity:0.8; text-decoration:none; font-size:12px;">${u}</a></div>%60).join(""):'<span style="color:#64748b;">Keine EintrÃ¤ge</span>'}</div>%60;return d};contentBox.appendChild(mkAcc("Safe URLs",safe,"#4ade80","âœ”"));contentBox.appendChild(mkAcc("Blocked URLs",blocked,"#f87171","âœ˜"))};run()})();