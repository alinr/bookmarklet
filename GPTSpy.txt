javascript:(async function(){const ID="gpt-spy-v6-no-text-on-search";const old=document.getElementById(ID);if(old)old.remove();if(window.gptSpyObs){window.gptSpyObs.disconnect();delete window.gptSpyObs}let timer=null;const showLoading=()=>{let c=document.getElementById(ID);if(!c){c=document.createElement("div");c.id=ID;const s=document.createElement("style");s.innerHTML=`#${ID}{position:fixed;top:20px;right:20px;width:450px;max-height:90vh;background-color:#0f172a;color:#e2e8f0;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.5);z-index:2147483647;font-family:system-ui,-apple-system,sans-serif;font-size:13px;border:1px solid #1e293b;display:flex;flex-direction:column;overflow:hidden}#${ID} *{box-sizing:border-box}#${ID}-loading{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;gap:15px;color:#94a3b8}.spy-spinner{width:30px;height:30px;border:3px solid rgba(255,255,255,0.1);border-top-color:#38bdf8;border-radius:50%;animation:spy-spin 1s linear infinite}@keyframes spy-spin{to{transform:rotate(360deg)}}#${ID}-header{padding:16px;border-bottom:1px solid #1e293b;background:#020617;display:flex;justify-content:space-between;align-items:center;flex-shrink:0}#${ID}-content{padding:0;overflow-y:auto;background:#0f172a;flex-grow:1}.spy-details{border-bottom:1px solid #1e293b}.spy-summary{padding:12px 16px;cursor:pointer;background:#0f172a;font-weight:600;list-style:none;display:flex;align-items:center;justify-content:space-between;transition:background .2s}.spy-summary:hover{background:#1e293b}.spy-summary::-webkit-details-marker{display:none}.spy-badge{background:#1e293b;color:#94a3b8;font-size:11px;padding:2px 8px;border-radius:12px;border:1px solid #334155;min-width:24px;text-align:center}.spy-body{padding:12px 16px;background:#020617;border-top:1px solid #1e293b}.spy-ul{margin:0;padding:0;list-style:none;margin-bottom:10px;border-bottom:1px solid #1e293b;padding-bottom:10px}.spy-li{margin-bottom:8px;display:flex;align-items:start;line-height:1.5;color:#cbd5e1}.spy-q-icon{color:#f472b6;margin-right:10px;font-weight:bold}.spy-res-link{color:#38bdf8;text-decoration:none;display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:500}.spy-res-link:hover{text-decoration:underline}.spy-res-source{color:#64748b;font-size:11px}.spy-text{white-space:pre-wrap;color:#cbd5e1;line-height:1.6;font-size:12px}.spy-footer{text-align:center;font-size:11px;color:#475569;padding:12px;background:#020617;border-top:1px solid #1e293b;flex-shrink:0}.spy-model-badge{background:#0f172a;color:#38bdf8;border:1px solid #1e293b;padding:2px 6px;border-radius:4px;font-size:10px}%60;c.appendChild(s);const h=document.createElement("div");h.id=%60${ID}-header%60;h.innerHTML='<div><strong style="color: #fff; font-size: 16px;">GPT Spy</strong></div><span id="close-spy-mod" style="cursor:pointer; color:#64748b; font-weight:bold; padding:4px;">âœ•</span>';c.appendChild(h);const co=document.createElement("div");co.id=%60${ID}-content%60;co.innerHTML=%60<div id="${ID}-loading"><div class="spy-spinner"></div><div>Lade Daten...</div></div>%60;c.appendChild(co);const f=document.createElement("div");f.className="spy-footer";f.textContent="powered by corpusrank.com";c.appendChild(f);document.body.appendChild(c);h.querySelector("#close-spy-mod").onclick=()=>{if(window.gptSpyObs)window.gptSpyObs.disconnect();c.remove()}}else{c.querySelector(%60#${ID}-content%60).innerHTML=%60<div id="${ID}-loading"><div class="spy-spinner"></div><div>Update...</div></div>%60}};const run=async()=>{showLoading();const match=window.location.href.match(/https:\/\/chatgpt\.com\/c\/([a-f0-9-]+)/);if(!match||!match[1]){return}const convId=match[1];try{const sReq=await fetch("/api/auth/session");if(!sReq.ok)return;const token=(await sReq.json()).accessToken;const cReq=await fetch(%60https://chatgpt.com/backend-api/conversation/${convId}%60,{headers:{Authorization:%60Bearer ${token}%60}});if(!cReq.ok)return;const data=await cReq.json();if(!data.mapping)return;const nodes=Object.values(data.mapping).filter(n=>n.message&&n.message.create_time).sort((a,b)=>a.message.create_time-b.message.create_time);let events=[];let safe=new Set();let blocked=new Set();let model="Unknown";nodes.forEach(n=>{const m=n.message;if(m.metadata&&m.metadata.safe_urls)m.metadata.safe_urls.forEach(u=>safe.add(u));if(m.metadata&&m.metadata.blocked_urls)m.metadata.blocked_urls.forEach(u=>blocked.add(u));if(m.metadata&&m.metadata.model_slug)model=m.metadata.model_slug;if(m.author.role!=="assistant"||!m.content||!m.content.parts)return;const txt=m.content.parts.join("").trim();if(!txt)return;let q=[];let r=[];let p="Unbekannt";let curr=n.parent;let steps=0;while(curr&&data.mapping[curr]&&steps<50){const pNode=data.mapping[curr].message;if(pNode){if(pNode.metadata&&pNode.metadata.search_model_queries&&pNode.metadata.search_model_queries.queries){q.push(...pNode.metadata.search_model_queries.queries)}if(pNode.metadata&&pNode.metadata.search_result_groups){pNode.metadata.search_result_groups.forEach(g=>{if(g.entries)g.entries.forEach(e=>{if(e.url)r.push({title:e.title||"No Title",url:e.url,source:e.attribution||g.domain||"Unknown"})})})}if(pNode.author.role==="user"){p=(pNode.content&&pNode.content.parts)?pNode.content.parts.join(" "):"Prompt";break}}curr=data.mapping[curr].parent;steps++}events.push({prompt:p.replace(/^search\s*\(.*?\)$/g,""),queries:q,text:txt,results:r})});events.reverse();render(events,[...safe],[...blocked],model)}catch(e){console.error(e)}};const debouncedRun=()=>{clearTimeout(timer);timer=setTimeout(run,2000)};window.gptSpyObs=new MutationObserver(ms=>{let upd=false;for(let m of ms){if(m.target.id===ID||(m.target.closest&&m.target.closest("#"+ID)))continue;upd=true}if(upd)debouncedRun()});window.gptSpyObs.observe(document.body,{childList:true,subtree:true});const render=(events,safe,blocked,modelName)=>{let c=document.getElementById(ID);if(!c)return;c.querySelector(%60#${ID}-header > div%60).innerHTML=%60<strong style="color: #fff; font-size: 16px;">GPT Spy</strong> <span class="spy-model-badge">${modelName}</span> <span style="color:#10b981; font-size:16px; margin-left:5px; line-height:0; position:relative; top:3px;">â€¢</span>%60;const cb=c.querySelector(%60#${ID}-content%60);cb.innerHTML="";if(events.length===0){cb.innerHTML='<div style="padding:20px; color:#64748b; text-align:center; font-style: italic;">Keine Daten gefunden.</div>'}else{events.forEach((evt,idx)=>{const d=document.createElement("details");d.className="spy-details";if(idx===0)d.open=true;const hasQ=evt.queries.length>0;const icon=hasQ?"?":"ðŸ‘¤";const s=document.createElement("summary");s.className="spy-summary";s.innerHTML=%60<div style="display:flex; align-items:center; width:100%; overflow:hidden;"><span class="spy-q-icon" style="margin-right:10px; font-size:16px;">${icon}</span><span style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis; color:#e2e8f0;">${evt.prompt}</span></div><span class="spy-badge">${events.length-idx}</span>%60;const b=document.createElement("div");b.className="spy-body";if(hasQ){const ul=document.createElement("ul");ul.className="spy-ul";evt.queries.forEach(q=>{ul.innerHTML+=%60<li class="spy-li"><span class="spy-q-icon">?</span><span>${q}</span></li>%60});b.appendChild(ul)}else{const t=document.createElement("div");t.className="spy-text";t.innerText=evt.text;b.appendChild(t)}if(evt.results.length>0){const rd=document.createElement("details");rd.style.marginTop="12px";rd.open=true;rd.innerHTML=%60<summary style="cursor:pointer; color:#38bdf8; font-size:12px; font-weight:bold; margin-bottom:8px; list-style:none;">ðŸ“„ Ergebnisse anzeigen (${evt.results.length})</summary><div style="padding-left:12px; border-left:2px solid #1e293b; margin-top:8px;">${evt.results.map(r=>%60<div style="margin-bottom:8px;"><a href="${r.url}" target="_blank" class="spy-res-link">${r.title}</a><div class="spy-res-source">${r.source}</div></div>%60).join("")}</div>%60;b.appendChild(rd)}d.appendChild(s);d.appendChild(b);cb.appendChild(d)})}cb.appendChild(document.createElement("hr")).style.borderColor="#1e293b";const mk=(t,l,cl,ic)=>{const d=document.createElement("details");d.className="spy-details";d.innerHTML=%60<summary class="spy-summary"><div style="display:flex; align-items:center;"><span style="color:${cl}; margin-right:8px;">${ic}</span> ${t}</div><span class="spy-badge">${l.length}</span></summary><div class="spy-body" style="word-break:break-all;">${l.length?l.map(u=>%60<div style="margin-bottom:6px;"><a href="${u}" target="_blank" style="color:${cl}; opacity:0.8; text-decoration:none; font-size:12px;">${u}</a></div>%60).join(""):'<span style="color:#64748b;">Keine EintrÃ¤ge</span>'}</div>%60;return d};cb.appendChild(mk("Safe URLs",[...safe],"#4ade80","âœ”"));cb.appendChild(mk("Blocked URLs",[...blocked],"#f87171","âœ˜"))};run()})();