javascript:(async()=>{const I="gpt-spy";let D=null,T=null,F=!0;document.getElementById(I)?.remove();window.gptSpyObs?.disconnect();const L=i=>{let c=document.getElementById(I);if(!c){c=document.createElement("div");c.id=I;c.innerHTML=`<style>#${I}{position:fixed;top:20px;right:20px;width:450px;max-height:90vh;background:#0f172a;color:#e2e8f0;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,.5);z-index:2147483647;font:13px system-ui,sans-serif;border:1px solid #1e293b;display:flex;flex-direction:column;overflow:hidden}#${I} *{box-sizing:border-box}.sh{padding:16px;border-bottom:1px solid #1e293b;background:#020617;display:flex;justify-content:space-between;align-items:center}.sc{overflow-y:auto;background:#0f172a;flex:1}.sf{text-align:center;font-size:11px;color:#475569;padding:12px;background:#020617;border-top:1px solid #1e293b}.sd{border-bottom:1px solid #1e293b}.ss{padding:12px 16px;cursor:pointer;background:#0f172a;font-weight:600;list-style:none;display:flex;align-items:center;justify-content:space-between}.ss:hover{background:#1e293b}.sb{background:#1e293b;color:#94a3b8;font-size:11px;padding:2px 8px;border-radius:12px;border:1px solid #334155}.sbo{padding:12px 16px;background:#020617;border-top:1px solid #1e293b}.sul{margin:0;padding:0 0 10px;list-style:none;border-bottom:1px solid #1e293b}.sli{margin-bottom:8px;display:flex;color:#cbd5e1}.sq{color:#f472b6;margin-right:10px;font-weight:bold}.srl{color:#38bdf8;text-decoration:none;display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.srs{color:#64748b;font-size:11px}.sld{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;gap:15px;color:#94a3b8}.sp{width:30px;height:30px;border:3px solid rgba(255,255,255,.1);border-top-color:#38bdf8;border-radius:50%;animation:sp 1s linear infinite}.sps{width:14px;height:14px;border:2px solid rgba(255,255,255,.1);border-top-color:#38bdf8;border-radius:50%;animation:sp 1s linear infinite;margin-left:8px}@keyframes sp{to{transform:rotate(360deg)}}.btn{background:#1e293b;color:#94a3b8;border:1px solid #334155;padding:4px 10px;border-radius:6px;font-size:11px;cursor:pointer}.btn:hover{background:#334155;color:#e2e8f0}.mb{background:#0f172a;color:#38bdf8;border:1px solid #1e293b;padding:2px 6px;border-radius:4px;font-size:10px}</style><div class="sh"><div id="ht"><strong style="color:#fff;font-size:16px">GPT Spy</strong><span id="ui"></span></div><div style="display:flex;gap:10px;align-items:center"><button id="cp" class="btn">ðŸ“‹ JSON</button><span id="cl" style="cursor:pointer;color:#64748b;font-weight:bold;padding:4px">âœ•</span></div></div><div class="sc" id="ct"><div class="sld"><div class="sp"></div><div>Lade...</div></div></div><div class="sf">powered by corpusrank.com</div>%60;document.body.appendChild(c);c.querySelector("#cl").onclick=()=>{window.gptSpyObs?.disconnect();c.remove()};c.querySelector("#cp").onclick=async()=>{const b=c.querySelector("#cp");if(D){try{await navigator.clipboard.writeText(JSON.stringify(D,null,2));b.textContent="âœ“";b.style.background="#166534";setTimeout(()=>{b.textContent="ðŸ“‹ JSON";b.style.background=""},1500)}catch(e){b.textContent="âœ—"}}}}else if(!i)c.querySelector("#ui").innerHTML='<span class="sps"></span>'};const H=()=>{document.getElementById(I)?.querySelector("#ui")&&(document.querySelector("#ui").innerHTML="")};const R=async()=>{L(F);const m=location.href.match(/chatgpt\.com\/c\/([a-f0-9-]+)/);if(!m?.[1])return H();try{const s=await fetch("/api/auth/session");if(!s.ok)return H();const t=(await s.json()).accessToken;const r=await fetch(%60https://chatgpt.com/backend-api/conversation/${m[1]}%60,{headers:{Authorization:%60Bearer ${t}%60}});if(!r.ok)return H();const d=await r.json();D=d;if(!d.mapping)return H();const n=Object.values(d.mapping).filter(x=>x.message?.create_time).sort((a,b)=>a.message.create_time-b.message.create_time);let e=[],sf=new Set,bl=new Set,mo="?";n.forEach(x=>{const g=x.message;g.metadata?.safe_urls?.forEach(u=>sf.add(u));g.metadata?.blocked_urls?.forEach(u=>bl.add(u));if(g.metadata?.model_slug)mo=g.metadata.model_slug;if(g.author.role!=="assistant"||!g.content?.parts)return;const tx=g.content.parts.join("").trim();if(!tx)return;let q=[],rs=[],p="?",cr=x.parent,st=0;while(cr&&d.mapping[cr]&&st<50){const pN=d.mapping[cr].message;if(pN){pN.metadata?.search_model_queries?.queries&&q.push(...pN.metadata.search_model_queries.queries);pN.metadata?.search_result_groups?.forEach(gr=>gr.entries?.forEach(en=>en.url&&rs.push({t:en.title||"?",u:en.url,s:en.attribution||gr.domain||"?"})));if(pN.author.role==="user"){p=pN.content?.parts?.join(" ")||"?";break}}cr=d.mapping[cr].parent;st++}e.push({p:p.replace(/^search\s*\(.*?\)$/g,""),q,tx,rs})});e.reverse();V(e,[...sf],[...bl],mo);F=!1}catch(x){console.error(x);H()}};const V=(e,sf,bl,mo)=>{const c=document.getElementById(I);if(!c)return;c.querySelector("#ht").innerHTML=%60<strong style="color:#fff;font-size:16px">GPT Spy</strong> <span class="mb">${mo}</span> <span style="color:#10b981;font-size:16px;margin-left:5px">â€¢</span><span id="ui"></span>%60;const ct=c.querySelector("#ct");ct.innerHTML="";if(!e.length){ct.innerHTML='<div style="padding:20px;color:#64748b;text-align:center">Keine Daten</div>';return}e.forEach((ev,i)=>{const dt=document.createElement("details");dt.className="sd";if(!i)dt.open=!0;const hQ=ev.q.length>0;dt.innerHTML=%60<summary class="ss"><div style="display:flex;align-items:center;width:100%;overflow:hidden"><span class="sq" style="margin-right:10px;font-size:16px">${hQ?"?":"ðŸ‘¤"}</span><span style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${ev.p}</span></div><span class="sb">${e.length-i}</span></summary><div class="sbo">${hQ?%60<ul class="sul">${ev.q.map(q=>%60<li class="sli"><span class="sq">?</span><span>${q}</span></li>%60).join("")}</ul>%60:%60<div style="white-space:pre-wrap;color:#cbd5e1;font-size:12px">${ev.tx}</div>%60}${ev.rs.length?%60<details open style="margin-top:12px"><summary style="cursor:pointer;color:#38bdf8;font-size:12px;font-weight:bold;list-style:none">ðŸ“„ ${ev.rs.length} Ergebnisse</summary><div style="padding-left:12px;border-left:2px solid #1e293b;margin-top:8px">${ev.rs.map(r=>%60<div style="margin-bottom:8px"><a href="${r.u}" target="_blank" class="srl">${r.t}</a><div class="srs">${r.s}</div></div>%60).join("")}</div></details>%60:""}</div>%60;ct.appendChild(dt)});const mk=(t,l,cl,ic)=>{const d=document.createElement("details");d.className="sd";d.innerHTML=%60<summary class="ss"><div style="display:flex;align-items:center"><span style="color:${cl};margin-right:8px">${ic}</span>${t}</div><span class="sb">${l.length}</span></summary><div class="sbo" style="word-break:break-all">${l.length?l.map(u=>%60<div style="margin-bottom:6px"><a href="${u}" target="_blank" style="color:${cl};opacity:.8;text-decoration:none;font-size:12px">${u}</a></div>%60).join(""):'<span style="color:#64748b">â€”</span>'}</div>%60;return d};ct.appendChild(mk("Safe",sf,"#4ade80","âœ”"));ct.appendChild(mk("Blocked",bl,"#f87171","âœ˜"))};window.gptSpyObs=new MutationObserver(ms=>{let u=!1;for(let m of ms){if(m.target.id===I||m.target.closest?.("#"+I))continue;u=!0}if(u){clearTimeout(T);T=setTimeout(R,2000)}});window.gptSpyObs.observe(document.body,{childList:!0,subtree:!0});R()})();